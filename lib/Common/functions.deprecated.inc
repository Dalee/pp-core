<?php
/**
 * Project:     Dalee PHP-classes library
 * Deprectated global functions of Proxima Portal
 *
 * @copyright   Dalee, 2003-2013
 * @package     ProximaPortal
 * @subpackage  Common
 */

function _PrepareWMLText($string) {
	$string = preg_replace("/\\$\s*(\d+([,|.]\d+)?)/si", "\\1 у.е.", $string);

	if(preg_match_all("/<a\s.*?(href=\"(.+?)\").*?>(.+?)<\/a>/si", $string, $urls)) {
		$string = preg_replace("/<a\s.*?href=\"(.+?)\".*?>(.+?)<\/a>/si", "[a \\1]\\2[/a]", $string);
	}

	$string = strip_tags($string);
	$string = nl2br($string);

	$string = preg_replace("/\[a (.*?)\](.*?)\[\/a\]/si", "<a href=\"\\1\">\\2</a>", $string);

	return $string;
}

function SortRussianByTitle($a, $b) {
	if ($a == $b) return 0;
	$tmp = strcmp(myconv($a['title'], DEFAULT_CHARSET, CHARSET_WINDOWS), myconv($b['title'], DEFAULT_CHARSET, CHARSET_WINDOWS));
	return ($tmp < 0);
}

function wapUtf8Cyr($str) {
	static $trans = array(
		'а' => '&#x0430;', 'б' => '&#x0431;', 'в' => '&#x0432;', 'г' => '&#x0433;', 'д' => '&#x0434;',
		'е' => '&#x0435;', 'ж' => '&#x0436;', 'з' => '&#x0437;', 'и' => '&#x0438;', 'й' => '&#x0439;',
		'к' => '&#x043A;', 'л' => '&#x043B;', 'м' => '&#x043C;', 'н' => '&#x043D;', 'о' => '&#x043E;',
		'п' => '&#x043F;', 'р' => '&#x0440;', 'с' => '&#x0441;', 'т' => '&#x0442;', 'у' => '&#x0443;',
		'ф' => '&#x0444;', 'х' => '&#x0445;', 'ц' => '&#x0446;', 'ч' => '&#x0447;', 'ш' => '&#x0448;',
		'щ' => '&#x0449;', 'ъ' => '&#x044A;', 'ы' => '&#x044B;', 'ь' => '&#x044C;', 'э' => '&#x044D;',
		'ю' => '&#x044E;', 'я' => '&#x044F;',

		'А' => '&#x0410;', 'Б' => '&#x0411;', 'В' => '&#x0412;', 'Г' => '&#x0413;', 'Д' => '&#x0414;',
		'Е' => '&#x0415;', 'Ж' => '&#x0416;', 'З' => '&#x0417;', 'И' => '&#x0418;', 'Й' => '&#x0419;',
		'К' => '&#x041A;', 'Л' => '&#x041B;', 'М' => '&#x041C;', 'Н' => '&#x041D;', 'О' => '&#x041E;',
		'П' => '&#x041F;', 'Р' => '&#x0420;', 'С' => '&#x0421;', 'Т' => '&#x0422;', 'У' => '&#x0423;',
		'Ф' => '&#x0424;', 'Х' => '&#x0425;', 'Ц' => '&#x0426;', 'Ч' => '&#x0427;', 'Ш' => '&#x0428;',
		'Щ' => '&#x0429;', 'Ъ' => '&#x042A;', 'Ы' => '&#x042B;', 'Ь' => '&#x042C;', 'Э' => '&#x042D;',
		'Ю' => '&#x042E;', 'Я' => '&#x042F;',

		'&nbsp;'   => ' ',
		'&laquo;'  => '&#x00AB;',
		'&raquo;'  => '&#x00BB;',
		'&bdquo;'  => '&#x0093;',
		'&ldquo;'  => '&#x0084;',
//		'&rdquo;'  => '&#x0093;',
		'&rdquo;'  => '\'',
		'&#8212;'  => '-',
		'&mdash;'  => '-',
		'&ndash;'  => '-',
		'&#150;'   => '-',
		'&#8211;'  => '&#x2013;',
		'&hellip;' => '...',
		'&#8217;'  => '&#x2019;',
		'&#8470;'  => '&#x2116;',

//		'&' => '&#x0026;', '$' => '&#xFE69; &#xFF04;', '#' => '&#x0023;',
//		'&' => '&#x0026;', '$' => '&#xFF04;', '#' => '&#x0023;',
		'&' => '&#x0026;', '#' => '&#x0023;',

		'&#x2190;' => '&#x003C;', '&#x2191;' => '&#x003C;', '&#x2192;' => '&#x003E;', '&#x2193;' => '&#x003E;',
	);

	return strtr($str, $trans);
}


function utfDecode($string) {
	return utfEncode($string, 'decode');
}

function utfEncode($string, $direction = 'encode') {
	static $tran = array(
		"%A8"=>"%D0%81", "%B8"=>"%D1%91", "%C0"=>"%D0%90", "%C1"=>"%D0%91", "%C2"=>"%D0%92", "%C3"=>"%D0%93",
		"%C4"=>"%D0%94", "%C5"=>"%D0%95", "%C6"=>"%D0%96", "%C7"=>"%D0%97", "%C8"=>"%D0%98", "%C9"=>"%D0%99",
		"%CA"=>"%D0%9A", "%CB"=>"%D0%9B", "%CC"=>"%D0%9C", "%CD"=>"%D0%9D", "%CE"=>"%D0%9E", "%CF"=>"%D0%9F",
		"%D0"=>"%D0%A0", "%D1"=>"%D0%A1", "%D2"=>"%D0%A2", "%D3"=>"%D0%A3", "%D4"=>"%D0%A4", "%D5"=>"%D0%A5",
		"%D6"=>"%D0%A6", "%D7"=>"%D0%A7", "%D8"=>"%D0%A8", "%D9"=>"%D0%A9", "%DA"=>"%D0%AA", "%DB"=>"%D0%AB",
		"%DC"=>"%D0%AC", "%DD"=>"%D0%AD", "%DE"=>"%D0%AE", "%DF"=>"%D0%AF", "%E0"=>"%D0%B0", "%E1"=>"%D0%B1",
		"%E2"=>"%D0%B2", "%E3"=>"%D0%B3", "%E4"=>"%D0%B4", "%E5"=>"%D0%B5", "%E6"=>"%D0%B6", "%E7"=>"%D0%B7",
		"%E8"=>"%D0%B8", "%E9"=>"%D0%B9", "%EA"=>"%D0%BA", "%EB"=>"%D0%BB", "%EC"=>"%D0%BC", "%ED"=>"%D0%BD",
		"%EE"=>"%D0%BE", "%EF"=>"%D0%BF", "%F0"=>"%D1%80", "%F1"=>"%D1%81", "%F2"=>"%D1%82", "%F3"=>"%D1%83",
		"%F4"=>"%D1%84", "%F5"=>"%D1%85", "%F6"=>"%D1%86", "%F7"=>"%D1%87", "%F8"=>"%D1%88", "%F9"=>"%D1%89",
		"%FA"=>"%D1%8A", "%FB"=>"%D1%8B", "%FC"=>"%D1%8C", "%FD"=>"%D1%8D", "%FE"=>"%D1%8E", "%FF"=>"%D1%8F",
	);

	static $typo = array(
		"%C2%A7"=>"&#167;",
		"%C2%A9"=>"&#169;",
		"%C2%AB"=>"&#171;",
		"%C2%AE"=>"&#174;",
		"%C2%B0"=>"&#176;",
		"%C2%B1"=>"&#177;",
		"%C2%BB"=>"&#187;",
		"%E2%80%93"=>"&#150;",
		"%E2%80%94"=>"&#151;",
		"%E2%80%9C"=>"&#147;",
		"%E2%80%9D"=>"&#148;",
		"%E2%80%9E"=>"&#132;",
		"%E2%80%A6"=>"&#133;",
		"%E2%84%96"=>"&#8470;",
		"%E2%84%A2"=>"&#153;",
		"%C2%A4"=>"&curren;",
		"%C2%B6"=>"&para;",
		"%C2%B7"=>"&middot;",
		"%E2%80%98"=>"&#145;",
		"%E2%80%99"=>"&#146;",
		"%E2%80%A2"=>"&#149;",
	);

	static $rtypo = array(
		"%84"=>"%E2%80%9E",
		"%85"=>"%E2%80%A6",
		"%91"=>"%E2%80%98",
		"%92"=>"%E2%80%99",
		"%93"=>"%E2%80%9C",
		"%94"=>"%E2%80%9D",
		"%95"=>"%E2%80%A2",
		"%96"=>"%E2%80%93",
		"%97"=>"%E2%80%94",
		"%99"=>"%E2%84%A2",
		"%A7"=>"%C2%A7",
		"%A9"=>"%C2%A9",
		"%AB"=>"%C2%AB",
		"%AE"=>"%C2%AE",
		"%B0"=>"%C2%B0",
		"%B1"=>"%C2%B1",
		"%BB"=>"%C2%BB",
	);

	if ($direction == "encode") {
		$tran = array_merge($tran,$rtypo);
		$string = strtr(urlencode($string),$tran);
	} else {
		$rtran = array_flip($tran);
		$rtran = array_merge($rtran,$typo);
		$string = strtr(urlencode($string),$rtran);
	}

	return urldecode($string);
}
